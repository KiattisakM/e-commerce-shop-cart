# Implementation Plan: E-Commerce Platform (Updated with pnpm)

**Created:** 2025-11-05 16:22
**Based on Context:** context_v1_20251105.md
**Session ID:** 20251105_155658
**Update:** Using pnpm package manager

## Overview

Building a modern, full-featured e-commerce platform using cutting-edge technologies:
- **Frontend:** Next.js 16 (App Router) + React 19
- **Styling:** Tailwind CSS 4 + shadcn/ui components
- **Type Safety:** TypeScript
- **CMS:** Sanity CMS for content management
- **Animations:** Framer Motion
- **Package Manager:** **pnpm** (fast, disk-efficient)
- **Architecture:** Server Components, API Routes, Optimistic UI

## Tech Stack Details

| Technology | Version | Purpose |
|------------|---------|---------|
| Next.js | 16 | React framework with App Router |
| React | 19 | UI library with latest features |
| TypeScript | 5.x | Type safety |
| Tailwind CSS | 4 | Utility-first styling |
| shadcn/ui | Latest | Pre-built accessible components |
| Sanity CMS | Latest | Headless CMS for products/content |
| Framer Motion | Latest | Animations and transitions |
| **pnpm** | **Latest** | **Fast package manager** |

## Prerequisites

- [x] Node.js 20+ installed
- [ ] pnpm installed globally (`npm install -g pnpm`)
- [ ] Sanity account created
- [ ] Git repository initialized
- [ ] Environment variables configured

---

## Phase 1: Project Setup & Foundation
**Goal:** Initialize project with all dependencies and basic configuration
**Estimated Time:** 1-2 hours

### Tasks

- [ ] **Task 1.1:** Install pnpm globally
  - Tool: Manual (command line)
  - Reasoning Level: low
  - Dependencies: None
  - Commands:
    ```bash
    npm install -g pnpm
    pnpm --version
    ```
  - Success Criteria: pnpm installed and verified

- [ ] **Task 1.2:** Initialize Next.js 16 project with TypeScript
  - Tool: Manual (command line)
  - Reasoning Level: low
  - Dependencies: Task 1.1
  - Commands:
    ```bash
    pnpm create next-app@latest . --typescript --tailwind --app --use-pnpm
    # or if starting fresh in new dir:
    # pnpm create next-app@latest shopcart-by-claude --typescript --tailwind --app --use-pnpm
    ```
  - Success Criteria: Next.js project created with App Router structure

- [ ] **Task 1.3:** Install and configure Tailwind CSS 4
  - Tool: Manual (pnpm/config)
  - Reasoning Level: low
  - Dependencies: Task 1.2
  - Commands:
    ```bash
    pnpm add -D tailwindcss@next postcss autoprefixer
    pnpm dlx tailwindcss init -p
    ```
  - Success Criteria: Tailwind 4 configured, custom theme setup in tailwind.config.ts

- [ ] **Task 1.4:** Set up shadcn/ui component library
  - Tool: Manual (CLI)
  - Reasoning Level: low
  - Dependencies: Task 1.3
  - Commands:
    ```bash
    pnpm dlx shadcn@latest init
    pnpm dlx shadcn@latest add button card input label select
    ```
  - Success Criteria: shadcn/ui initialized with essential components

- [ ] **Task 1.5:** Install additional dependencies
  - Tool: Manual (pnpm)
  - Reasoning Level: low
  - Dependencies: Task 1.4
  - Commands:
    ```bash
    pnpm add framer-motion next-sanity @sanity/image-url
    pnpm add react-hook-form zod @hookform/resolvers
    pnpm add zustand
    pnpm add lucide-react
    pnpm add -D @types/node
    ```
  - Packages:
    - `framer-motion` - Animations
    - `next-sanity` - Sanity integration
    - `@sanity/image-url` - Image optimization
    - `react-hook-form` - Form handling
    - `zod` - Schema validation
    - `zustand` - State management
    - `lucide-react` - Icons
  - Success Criteria: All packages installed without conflicts

- [ ] **Task 1.6:** Configure TypeScript strict mode
  - Tool: `codex-exec.sh` or Manual
  - Reasoning Level: low
  - Dependencies: Task 1.2
  - File: `tsconfig.json`
  - Success Criteria: Strict mode enabled, path aliases configured (@/components, @/lib, etc.)

---

## Phase 2: Sanity CMS Setup
**Goal:** Configure headless CMS for product and content management
**Estimated Time:** 2-3 hours

### Tasks

- [ ] **Task 2.1:** Initialize Sanity project
  - Tool: Manual (Sanity CLI with pnpm)
  - Reasoning Level: low
  - Dependencies: Phase 1 complete
  - Commands:
    ```bash
    pnpm add -g @sanity/cli
    pnpm dlx sanity init
    # Follow prompts to create project
    ```
  - Success Criteria: Sanity studio created in `/sanity` directory

- [ ] **Task 2.2:** Define Sanity schemas
  - Tool: `codex-exec.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Task 2.1
  - Schemas to create:
    - `product.ts` - Product information
    - `category.ts` - Product categories
    - `collection.ts` - Product collections
    - `order.ts` - Order history
    - `customer.ts` - Customer data
    - `siteSettings.ts` - Global site config
  - Success Criteria: All schemas defined with proper validation

- [ ] **Task 2.3:** Configure Sanity client for Next.js
  - Tool: `codex-exec.sh` with `low` reasoning
  - Reasoning Level: low
  - Dependencies: Task 2.2
  - Files:
    - `lib/sanity.client.ts` - Client configuration
    - `lib/sanity.queries.ts` - GROQ queries
    - `lib/sanity.image.ts` - Image URL builder
  - Success Criteria: Client configured with proper API credentials

- [ ] **Task 2.4:** Deploy Sanity Studio
  - Tool: Manual (Sanity CLI)
  - Reasoning Level: low
  - Dependencies: Task 2.3
  - Commands:
    ```bash
    cd sanity
    pnpm run build
    pnpm dlx sanity deploy
    ```
  - Success Criteria: Studio accessible via URL, can create test products

---

## Phase 3: Project Structure & Architecture
**Goal:** Set up proper folder structure and core utilities
**Estimated Time:** 1-2 hours

### Tasks

- [ ] **Task 3.1:** Create folder structure
  - Tool: `codex-exec.sh` with `low` reasoning
  - Reasoning Level: low
  - Dependencies: Phase 2 complete
  - Structure:
    ```
    src/
    â”œâ”€â”€ app/                    # Next.js App Router
    â”‚   â”œâ”€â”€ (shop)/            # Shop routes group
    â”‚   â”œâ”€â”€ (admin)/           # Admin routes group
    â”‚   â””â”€â”€ api/               # API routes
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ ui/                # shadcn components
    â”‚   â”œâ”€â”€ product/           # Product components
    â”‚   â”œâ”€â”€ cart/              # Cart components
    â”‚   â””â”€â”€ layout/            # Layout components
    â”œâ”€â”€ lib/
    â”‚   â”œâ”€â”€ sanity/            # Sanity utilities
    â”‚   â”œâ”€â”€ utils/             # Helper functions
    â”‚   â””â”€â”€ hooks/             # Custom React hooks
    â”œâ”€â”€ types/                 # TypeScript types
    â””â”€â”€ styles/                # Global styles
    ```
  - Success Criteria: All directories created, barrel exports configured

- [ ] **Task 3.2:** Define TypeScript types
  - Tool: `codex-exec.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Task 3.1
  - Types to define:
    - `Product` - Product data structure
    - `Category` - Category structure
    - `CartItem` - Shopping cart item
    - `Order` - Order details
    - `Customer` - Customer profile
  - Success Criteria: Complete type definitions with proper exports

- [ ] **Task 3.3:** Set up utility functions
  - Tool: `codex-exec.sh` with `low` reasoning
  - Reasoning Level: low
  - Dependencies: Task 3.2
  - Utilities:
    - `lib/utils/currency.ts` - Price formatting
    - `lib/utils/validation.ts` - Form validation
    - `lib/utils/cart.ts` - Cart calculations
    - `lib/utils/slug.ts` - URL slug generation
  - Success Criteria: All utilities created with tests

---

## Phase 4: Core Components Development
**Goal:** Build reusable UI components with shadcn/ui and Framer Motion
**Estimated Time:** 3-4 hours

### Tasks

- [ ] **Task 4.1:** Create product components
  - Tool: `codex-worker-launcher.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Phase 3 complete
  - Components:
    - `ProductCard.tsx` - Product grid item with animations
    - `ProductGrid.tsx` - Product listing grid
    - `ProductDetails.tsx` - Detailed product view
    - `ProductImage.tsx` - Optimized image with zoom
    - `ProductPrice.tsx` - Price display with variants
  - Success Criteria: All components built with TypeScript, animations, responsive

- [ ] **Task 4.2:** Create cart components
  - Tool: `codex-worker-launcher.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Task 4.1
  - Components:
    - `CartDrawer.tsx` - Slide-in cart with Framer Motion
    - `CartItem.tsx` - Individual cart item
    - `CartSummary.tsx` - Price breakdown
    - `CartButton.tsx` - Floating cart button with badge
  - Success Criteria: Functional cart with animations, optimistic updates

- [ ] **Task 4.3:** Create layout components
  - Tool: `codex-exec.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Task 4.1
  - Components:
    - `Header.tsx` - Responsive header with search
    - `Footer.tsx` - Footer with links
    - `Navigation.tsx` - Category navigation
    - `MobileMenu.tsx` - Mobile hamburger menu
    - `SearchBar.tsx` - Product search with autocomplete
  - Success Criteria: Complete layout system with mobile-first design

- [ ] **Task 4.4:** Create UI components with shadcn
  - Tool: `codex-exec.sh` with `low` reasoning
  - Reasoning Level: low
  - Dependencies: Task 1.4
  - Install additional shadcn components:
    ```bash
    pnpm dlx shadcn@latest add badge dialog dropdown-menu sheet toast
    ```
  - Custom components:
    - `LoadingSpinner.tsx`
    - `ErrorBoundary.tsx`
    - `Breadcrumbs.tsx`
  - Success Criteria: All UI components functional and styled

---

## Phase 5: Pages & Routing
**Goal:** Implement all pages using Next.js App Router
**Estimated Time:** 4-5 hours

### Tasks

- [ ] **Task 5.1:** Create shop pages (customer-facing)
  - Tool: `codex-worker-launcher.sh` with `high` reasoning
  - Reasoning Level: high
  - Dependencies: Phase 4 complete
  - Pages:
    - `app/(shop)/page.tsx` - Homepage with featured products
    - `app/(shop)/products/page.tsx` - All products with filters
    - `app/(shop)/products/[slug]/page.tsx` - Product detail page
    - `app/(shop)/categories/[slug]/page.tsx` - Category page
    - `app/(shop)/cart/page.tsx` - Full cart page
    - `app/(shop)/checkout/page.tsx` - Checkout flow
  - Success Criteria: All pages with Server Components, proper SEO, animations

- [ ] **Task 5.2:** Create API routes
  - Tool: `codex-worker-launcher.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Task 5.1
  - Routes:
    - `app/api/products/route.ts` - Product endpoints
    - `app/api/cart/route.ts` - Cart operations
    - `app/api/checkout/route.ts` - Checkout processing
    - `app/api/webhooks/route.ts` - Sanity webhooks
  - Success Criteria: RESTful API with proper error handling

- [ ] **Task 5.3:** Implement search and filtering
  - Tool: `codex-exec.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Task 5.2
  - Features:
    - Search bar with instant results
    - Filter by category, price, availability
    - Sort options (price, name, newest)
    - URL state management with query params
  - Success Criteria: Fast search with URL persistence

---

## Phase 6: State Management & Cart Logic
**Goal:** Implement shopping cart with Zustand and optimistic UI
**Estimated Time:** 2-3 hours

### Tasks

- [ ] **Task 6.1:** Set up Zustand store
  - Tool: `codex-exec.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Phase 5 complete
  - Files:
    - `lib/store/cart-store.ts` - Cart state management
    - `lib/store/ui-store.ts` - UI state (modals, drawers)
  - Features:
    - Add/remove cart items
    - Update quantities
    - Calculate totals
    - Persist to localStorage
  - Success Criteria: Complete cart state management with persistence

- [ ] **Task 6.2:** Implement cart operations
  - Tool: `codex-exec.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Task 6.1
  - Operations:
    - `addToCart()` - Add product to cart
    - `removeFromCart()` - Remove item
    - `updateQuantity()` - Change quantity
    - `clearCart()` - Empty cart
    - `getCartTotal()` - Calculate total
  - Success Criteria: All operations working with optimistic updates

---

## Phase 7: Animations & User Experience
**Goal:** Add smooth animations and transitions with Framer Motion
**Estimated Time:** 2-3 hours

### Tasks

- [ ] **Task 7.1:** Implement page transitions
  - Tool: `codex-exec.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Phase 6 complete
  - Animations:
    - Fade in/out on route changes
    - Slide animations for modals/drawers
    - Scale animations for product cards
    - Stagger animations for product grids
  - Success Criteria: Smooth 60fps animations across all pages

- [ ] **Task 7.2:** Add micro-interactions
  - Tool: `codex-exec.sh` with `low` reasoning
  - Reasoning Level: low
  - Dependencies: Task 7.1
  - Interactions:
    - Hover effects on cards/buttons
    - Cart badge bounce on add
    - Loading skeletons
    - Success/error toast animations
  - Success Criteria: Polished interactions enhancing UX

---

## Phase 8: SEO & Performance Optimization
**Goal:** Optimize for search engines and performance
**Estimated Time:** 2 hours

### Tasks

- [ ] **Task 8.1:** Configure metadata and SEO
  - Tool: `codex-exec.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Phase 7 complete
  - Implementation:
    - Dynamic metadata for each page
    - Open Graph tags
    - JSON-LD structured data
    - Sitemap generation
    - robots.txt
  - Success Criteria: Perfect SEO score on homepage and product pages

- [ ] **Task 8.2:** Optimize images and assets
  - Tool: `codex-exec.sh` with `low` reasoning
  - Reasoning Level: low
  - Dependencies: Task 8.1
  - Optimizations:
    - Next.js Image component everywhere
    - Proper image sizing from Sanity
    - Lazy loading
    - WebP format
    - Font optimization
  - Success Criteria: Lighthouse score 90+ on all metrics

---

## Phase 9: Testing & Quality Assurance
**Goal:** Ensure code quality and functionality
**Estimated Time:** 2-3 hours

### Tasks

- [ ] **Task 9.1:** Set up testing infrastructure
  - Tool: Manual (pnpm)
  - Reasoning Level: low
  - Dependencies: Phase 8 complete
  - Commands:
    ```bash
    pnpm add -D vitest @testing-library/react @testing-library/jest-dom
    pnpm add -D @playwright/test
    ```
  - Packages:
    - `vitest` - Unit testing
    - `@testing-library/react` - Component testing
    - `playwright` - E2E testing
  - Success Criteria: Testing environment configured

- [ ] **Task 9.2:** Write component tests
  - Tool: `codex-worker-launcher.sh` with `medium` reasoning
  - Reasoning Level: medium
  - Dependencies: Task 9.1
  - Tests for:
    - Product components
    - Cart functionality
    - Form validation
    - API routes
  - Success Criteria: 80%+ code coverage on critical paths

- [ ] **Task 9.3:** Manual testing checklist
  - Tool: Manual
  - Reasoning Level: N/A
  - Dependencies: Task 9.2
  - Test scenarios:
    - [ ] Browse products
    - [ ] Add to cart
    - [ ] Update quantities
    - [ ] Checkout flow
    - [ ] Mobile responsiveness
    - [ ] Cross-browser compatibility
  - Success Criteria: All scenarios pass without issues

---

## Phase 10: Deployment & Documentation
**Goal:** Deploy to production and create documentation
**Estimated Time:** 1-2 hours

### Tasks

- [ ] **Task 10.1:** Configure environment variables
  - Tool: Manual
  - Reasoning Level: low
  - Dependencies: Phase 9 complete
  - Variables:
    - `NEXT_PUBLIC_SANITY_PROJECT_ID`
    - `NEXT_PUBLIC_SANITY_DATASET`
    - `SANITY_API_TOKEN`
    - `NEXT_PUBLIC_SITE_URL`
  - Success Criteria: All secrets configured for production

- [ ] **Task 10.2:** Deploy to Vercel
  - Tool: Manual (Vercel CLI or Dashboard)
  - Reasoning Level: low
  - Dependencies: Task 10.1
  - Steps:
    1. Connect GitHub repository
    2. Configure environment variables
    3. **Set build command:** `pnpm run build`
    4. Deploy production build
    5. Set up custom domain (optional)
  - Success Criteria: Site live and accessible

- [ ] **Task 10.3:** Create documentation
  - Tool: `codex-exec.sh` with `low` reasoning
  - Reasoning Level: low
  - Dependencies: Task 10.2
  - Documents:
    - `README.md` - Project overview and setup with pnpm
    - `DEVELOPMENT.md` - Development guide
    - `SANITY.md` - CMS usage guide
    - `API.md` - API documentation
  - Success Criteria: Complete documentation for developers

---

## Package Manager Commands Reference

All commands use **pnpm**:

```bash
# Install dependencies
pnpm install

# Add package
pnpm add <package>
pnpm add -D <package>  # dev dependency

# Remove package
pnpm remove <package>

# Run scripts
pnpm dev
pnpm build
pnpm start
pnpm lint

# Execute packages (like npx)
pnpm dlx <package>

# Update packages
pnpm update
pnpm update --latest

# Clean install
pnpm install --frozen-lockfile
```

---

## Risks & Mitigations

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| **Next.js 16 breaking changes** | High | Medium | Use official migration guides, test thoroughly |
| **Tailwind 4 compatibility** | Medium | Low | Check plugin compatibility before install |
| **Sanity schema changes** | High | Low | Use migrations, backup data regularly |
| **Performance issues** | Medium | Medium | Use React Profiler, optimize images, lazy load |
| **Type safety gaps** | Low | Medium | Enable TypeScript strict mode, comprehensive types |
| **pnpm compatibility** | Low | Low | Most packages support pnpm, use pnpm dlx for executables |

## Success Criteria

- [ ] All pages load in < 2 seconds
- [ ] Lighthouse score 90+ on all metrics
- [ ] Full TypeScript coverage with no `any` types
- [ ] Responsive design works on all devices
- [ ] Cart persists across sessions
- [ ] Products load from Sanity CMS
- [ ] Smooth animations at 60fps
- [ ] Zero console errors/warnings
- [ ] Comprehensive documentation
- [ ] pnpm used exclusively (no npm/yarn)

## Rollback Plan

1. **Git branches:** Create feature branches for each phase
2. **Commits:** Commit after each completed task
3. **Backups:** Keep Sanity dataset backups
4. **Version pinning:** Lock all package versions in pnpm-lock.yaml
5. **Rollback:** Use `git revert` or `git reset` if needed

---

## Estimated Timeline

| Phase | Estimated Time |
|-------|---------------|
| Phase 1: Setup (pnpm) | 1-2 hours |
| Phase 2: Sanity CMS | 2-3 hours |
| Phase 3: Architecture | 1-2 hours |
| Phase 4: Components | 3-4 hours |
| Phase 5: Pages & Routing | 4-5 hours |
| Phase 6: State Management | 2-3 hours |
| Phase 7: Animations | 2-3 hours |
| Phase 8: SEO & Performance | 2 hours |
| Phase 9: Testing | 2-3 hours |
| Phase 10: Deployment | 1-2 hours |
| **Total** | **20-29 hours** |

---

## Notes

- **IMPORTANT:** Use `pnpm` for ALL package operations
- Use `pnpm dlx` instead of `npx` for executing packages
- Vercel automatically detects pnpm from pnpm-lock.yaml
- Use `gogogo` to start executing this plan step-by-step
- Each phase should be committed separately using `/git:commit`
- Run `lll` anytime to check progress
- Create retrospective with `rrr` after completion
- Background workers can handle long-running tasks in parallel
- Research report from Codex analyzing shopcartpro.reactbd.org will provide design inspiration

**Ready to execute?** Type `gogogo` to begin! ðŸš€
